(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{426:function(e,t,a){"use strict";a.r(t);var n=a(56),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"using-node-js-with-nubesgen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-node-js-with-nubesgen"}},[e._v("#")]),e._v(" Using Node.js with NubesGen")]),e._v(" "),a("p",[e._v("This documentation is for running Node.js applications with NubesGen, and there is another options that might interest you:")]),e._v(" "),a("ul",[a("li",[e._v("As Node.js applications can be packaged with Docker, you can also run them as "),a("RouterLink",{attrs:{to:"/runtimes/docker/"}},[e._v("Docker applications with NubesGen")]),e._v(".")],1)]),e._v(" "),a("p",[e._v("NubesGen supports creating Azure App Service instances and Azure Functions instances, depending on the type of Node.js application that you which to deploy.")]),e._v(" "),a("h2",{attrs:{id:"tutorial-running-a-node-js-application-with-nubesgen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tutorial-running-a-node-js-application-with-nubesgen"}},[e._v("#")]),e._v(" Tutorial: running a Node.js application with NubesGen")]),e._v(" "),a("p",[a("strong",[e._v("Prerequisites:")])]),e._v(" "),a("p",[a("em",[e._v("Tip: You can go to "),a("a",{attrs:{href:"https://aka.ms/nubesgen-azure-shell",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://aka.ms/nubesgen-azure-shell"),a("OutboundLink")],1),e._v(" to have those prerequisites installed, and run the script from a Web browser.")])]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://fr.wikipedia.org/wiki/Bourne-Again_shell",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bash"),a("OutboundLink")],1),e._v(", which is installed by default on most Linux distributions and on Mac OS X. If you're using Windows, one solution is to use "),a("a",{attrs:{href:"https://aka.ms/nubesgen-install-wsl",target:"_blank",rel:"noopener noreferrer"}},[e._v("WSL"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://aka.ms/nubesgen-install-az-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure CLI"),a("OutboundLink")],1),e._v(". To login, use "),a("code",[e._v("az login")]),e._v(".")]),e._v(" "),a("li",[e._v("(optional) "),a("a",{attrs:{href:"https://cli.github.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub CLI"),a("OutboundLink")],1),e._v(". To login, use "),a("code",[e._v("gh auth login")]),e._v(".")])]),e._v(" "),a("p",[a("strong",[e._v("Steps:")])]),e._v(" "),a("ol",[a("li",[e._v("Create a sample Node.js Web application using "),a("a",{attrs:{href:"https://nestjs.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("NestJs"),a("OutboundLink")],1),e._v(".\nWe'll follow the beginning of the "),a("a",{attrs:{href:"https://docs.nestjs.com/first-steps",target:"_blank",rel:"noopener noreferrer"}},[e._v('NestJs "first steps" guide'),a("OutboundLink")],1),e._v(":"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" i -g @nestjs/cli\nnest new nodejs-sample-app\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" nodejs-sample-app\n")])])]),e._v("Select the default package manager ("),a("code",[e._v("npm")]),e._v(").\nIn the project, open the "),a("code",[e._v("src/main.ts")]),e._v(" file, and use the "),a("code",[e._v("$PORT")]),e._v(" environment variable to bind your application\nto the correct port:"),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("PORT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("||")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),e._v("Open "),a("code",[e._v("package.json")]),e._v(" file, and add the "),a("code",[e._v("files")]),e._v(" entry to tell NPM how to package your app:"),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"files"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n   "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"dist"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])])]),e._v(" "),a("li",[e._v("Create a project on GitHub called "),a("code",[e._v("nodejs-sample-app")]),e._v(", and push the generated project to that repository. Change "),a("code",[e._v("<your-github-account>")]),e._v(" by the name of your GitHub account:"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" init\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" commit -m "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"first commit"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" remote "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" origin https://github.com/"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("your-github-account"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/nodejs-sample-app.git\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" branch -M main\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" push -u origin main\n")])])])]),e._v(" "),a("li",[e._v("In the cloned project ("),a("code",[e._v("cd nodejs-sample-app")]),e._v("), set up GitOps with NubesGen by running the NubesGen CLI ("),a("RouterLink",{attrs:{to:"/gitops/gitops-quick-start/"}},[e._v("more information here")]),e._v("):"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v(" ./nubesgen-cli-linux gitops\n")])])])],1),e._v(" "),a("li",[e._v("Use the command-line with NubesGen ("),a("RouterLink",{attrs:{to:"/reference/rest-api/"}},[e._v("more information here")]),e._v(") to generate a NubesGen configuration:"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"https://nubesgen.com/demo.tgz?runtime=nodejs&application=app_service.standard&gitops=true"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -xzvf -\n")])])])],1),e._v(" "),a("li",[e._v("Create a new branch called "),a("code",[e._v("env-dev")]),e._v(", and push your code:"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" checkout -b env-dev\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" commit -m "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Configure GitOps with NubesGen'")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" push --set-upstream origin env-dev\n")])])])]),e._v(" "),a("li",[e._v("Go to your GitHub project, and check that the GitHub Action is running.")]),e._v(" "),a("li",[e._v("You can go to the "),a("a",{attrs:{href:"https://aka.ms/nubesgen-portal",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Portal"),a("OutboundLink")],1),e._v(" to check the created resources.")]),e._v(" "),a("li",[e._v("The application should be deployed on your App Service instance. Its URL should be in the form "),a("code",[e._v("https://app-demo-XXXX-XXXX-XXXX-XXXX-dev-001.azurewebsites.net/")]),e._v(',\nand you can also find it in the GitHub Action workflow (Job: "manage-infrastructure", step "Apply Terraform"), or in the Azure portal.\nAs it is a simple application, it should print by default '),a("code",[e._v("Hello, world")]),e._v(".")]),e._v(" "),a("li",[e._v("Once you have finished, you should clean up your resources:")]),e._v(" "),a("li",[e._v("Delete the resource group that was created by NubesGen to host your resources, which is named "),a("code",[e._v("rg-demo-XXXX-XXXX-XXXX-XXXX-001")]),e._v(".")]),e._v(" "),a("li",[e._v("Delete the storage account used to store your Terraform state, in the "),a("code",[e._v("rg-terraform-001")]),e._v(" resource group.")])]),e._v(" "),a("h2",{attrs:{id:"which-azure-resources-are-created"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#which-azure-resources-are-created"}},[e._v("#")]),e._v(" Which Azure resources are created")]),e._v(" "),a("p",[e._v("If you deploy your Node.js application to an Azure App Service instance, NubesGen will generate:")]),e._v(" "),a("ul",[a("li",[e._v("An "),a("a",{attrs:{href:"https://aka.ms/nubesgen-app-service-plans",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure App Service plan"),a("OutboundLink")],1),e._v(" to define the type of App Service instance you will use.")]),e._v(" "),a("li",[e._v("An "),a("a",{attrs:{href:"https://aka.ms/nubesgen-app-service",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure App Service instance"),a("OutboundLink")],1),e._v(", configured to run Node.js code natively.")])]),e._v(" "),a("p",[e._v("If you deploy your Node.js application to an Azure Function, NubesGen will generate:")]),e._v(" "),a("ul",[a("li",[e._v("An "),a("a",{attrs:{href:"https://aka.ms/nubesgen-app-service-plans",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure App Service plan"),a("OutboundLink")],1),e._v(" to define the type of Azure Functions instance you will use.")]),e._v(" "),a("li",[e._v("An "),a("a",{attrs:{href:"https://aka.ms/nubesgen-functions",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Functions instance"),a("OutboundLink")],1),e._v(", configured to run Node.js code natively.")]),e._v(" "),a("li",[e._v("An "),a("a",{attrs:{href:"https://aka.ms/nubesgen-storage",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Storage Account"),a("OutboundLink")],1),e._v(", to store your Node.js application.")])]),e._v(" "),a("h2",{attrs:{id:"configuration-options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration-options"}},[e._v("#")]),e._v(" Configuration options")]),e._v(" "),a("p",[e._v("In the generated "),a("code",[e._v("terraform/modules/app-service/main.tf")]),e._v(" file, NubesGen will configure some variables\nfor your application.")]),e._v(" "),a("h3",{attrs:{id:"the-app-command-line-parameter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-app-command-line-parameter"}},[e._v("#")]),e._v(" The "),a("code",[e._v("app_command_line")]),e._v(" parameter")]),e._v(" "),a("p",[e._v("In the "),a("code",[e._v("site_config")]),e._v(" block, NubesGen generates the following configuration:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('app_command_line = "npm run start:prod"\n')])])]),a("p",[e._v("This command is the one used to run the Node.js application. By default, this command\nis "),a("code",[e._v("npm run start:prod")]),e._v(", which is the default with "),a("a",{attrs:{href:"https://nestjs.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("NestJS"),a("OutboundLink")],1),e._v(", but this\nshould be specifically configured depending on the framework used.")]),e._v(" "),a("h3",{attrs:{id:"the-port-environment-variable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-port-environment-variable"}},[e._v("#")]),e._v(" The "),a("code",[e._v("PORT")]),e._v(" environment variable")]),e._v(" "),a("p",[e._v("Azure App Service automatically assigns the "),a("code",[e._v("PORT")]),e._v(" variable, so your Node.js application\ncan listen to the correct port.")]),e._v(" "),a("p",[e._v("You need to configure it in your application:")]),e._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[e._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("PORT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("||")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"other-options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other-options"}},[e._v("#")]),e._v(" Other options")]),e._v(" "),a("p",[e._v("NubesGen will configure some environment variables for your application.")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("DATABASE_URL")]),e._v(": the URL to your database")]),e._v(" "),a("li",[a("code",[e._v("DATABASE_USERNAME")]),e._v(": the database user name")]),e._v(" "),a("li",[a("code",[e._v("DATABASE_PASSWORD")]),e._v(": the database password")]),e._v(" "),a("li",[a("code",[e._v("REDIS_HOST")]),e._v(": the Redis host name")]),e._v(" "),a("li",[a("code",[e._v("REDIS_PASSWORD")]),e._v(": the Redis password")]),e._v(" "),a("li",[a("code",[e._v("REDIS_PORT")]),e._v(": the Redis port (by default "),a("code",[e._v("6380")]),e._v(")")]),e._v(" "),a("li",[a("code",[e._v("AZURE_STORAGE_ACCOUNT_NAME")]),e._v(": the storage account name")]),e._v(" "),a("li",[a("code",[e._v("AZURE_STORAGE_ACCOUNT_KEY")]),e._v(": the storage account key")]),e._v(" "),a("li",[a("code",[e._v("AZURE_STORAGE_BLOB_ENDPOINT")]),e._v(": the blob storage endpoint")]),e._v(" "),a("li",[a("code",[e._v("MONGODB_DATABASE")]),e._v(": the MongoDB database name")]),e._v(" "),a("li",[a("code",[e._v("MONGODB_URI")]),e._v(": the MongoDB database URL")])])])}),[],!1,null,null,null);t.default=s.exports}}]);